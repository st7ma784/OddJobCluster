# Default containerd config, with camera device passthrough for RPi

version = 2
[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    [plugins."io.containerd.grpc.v1.cri".containerd]
      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          runtime_type = "io.containerd.runc.v2"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
            SystemdCgroup = true
    [plugins."io.containerd.grpc.v1.cri".cni]
      bin_dir = "/opt/cni/bin"
      conf_dir = "/etc/cni/net.d"
    [plugins."io.containerd.grpc.v1.cri".registry]
      [plugins."io.containerd.grpc.v1.cri".registry.mirrors]
        [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]
          endpoint = ["https://registry-1.docker.io"]

  [plugins."io.containerd.runtime.v1.linux"]
    shim_debug = false

[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
  BinaryName = "/usr/bin/runc"

[plugins."io.containerd.grpc.v1.cri".containerd.default_runtime]
  base_runtime_spec = ""

[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
    # Add the camera device to the list of allowed devices
    devices = [
      { path = "/dev/video0", type = "c", major = 81, minor = 0, permissions = "rwm", uid = 0, gid = 0 },
      { path = "/dev/video10", type = "c", major = 81, minor = 1, permissions = "rwm", uid = 0, gid = 0 },
      { path = "/dev/video11", type = "c", major = 81, minor = 2, permissions = "rwm", uid = 0, gid = 0 },
      { path = "/dev/video12", type = "c", major = 81, minor = 3, permissions = "rwm", uid = 0, gid = 0 }
    ]
